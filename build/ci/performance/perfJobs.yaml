jobs:
  - job: Testing_Round_1
    timeoutInMinutes: 120
    strategy:
      matrix:
        Python37:
          PythonVersion: '3.7'
    pool: DSPerf
    steps:
      - task: Npm@1
        displayName: 'npm ci'
        inputs:
          workingDir: ${{ parameters.workingDirectory }}
          command: custom
          verbose: true
          customCommand: ci
      - task: Gulp@0
        displayName: 'Compile and check for errors'
        inputs:
          targets: 'prePublishNonBundle'
      - powershell: |
          mocha --require source-map-support/register --config ./build/.mocha.performance.json
          node ./build/ci/performance/savePerformanceResults.js

  - job: Testing_Round_2
    dependsOn:
      - Testing_Round_1
    timeoutInMinutes: 120
    strategy:
      matrix:
        Python37:
          PythonVersion: '3.7'
    pool: DSPerf
    steps:
      - powershell: |
          mocha --require source-map-support/register --config ./build/.mocha.performance.json
          node ./build/ci/performance/savePerformanceResults.js

  - job: Testing_Round_3
    dependsOn:
      - Testing_Round_2
    timeoutInMinutes: 120
    strategy:
      matrix:
        Python37:
          PythonVersion: '3.7'
    pool: DSPerf
    steps:
      - powershell: |
          mocha --require source-map-support/register --config ./build/.mocha.performance.json
          node ./build/ci/performance/savePerformanceResults.js

  - job: Testing_Round_4
    dependsOn:
      - Testing_Round_3
    timeoutInMinutes: 120
    strategy:
      matrix:
        Python37:
          PythonVersion: '3.7'
    pool: DSPerf
    steps:
      - powershell: |
          mocha --require source-map-support/register --config ./build/.mocha.performance.json
          node ./build/ci/performance/savePerformanceResults.js

  - job: Testing_Round_5
    dependsOn:
      - Testing_Round_4
    timeoutInMinutes: 120
    strategy:
      matrix:
        Python37:
          PythonVersion: '3.7'
    pool: DSPerf
    steps:
      - powershell: |
          mocha --require source-map-support/register --config ./build/.mocha.performance.json
          node ./build/ci/performance/savePerformanceResults.js
