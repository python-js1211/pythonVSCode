Refactor language server middleware to work in the browser.
